# tf-aws-infra

## Certificate Import Command

To import a certificate into AWS ACM, use the following command:

```bash
aws acm import-certificate \
    --certificate fileb://demo_amoghjayasimha_me.crt \
    --private-key fileb://private.key \
    --certificate-chain fileb://demo_amoghjayasimha_me.ca-bundle \
    --region us-east-1 \
    --profile demo
```

## Key Infrastructure Components

### üîê AWS KMS Encryption
- Custom AWS KMS keys are created for:
    - EC2 root volume encryption
    - RDS data storage
    - S3 bucket encryption
    - Secrets Manager encryption
- Key rotation is enabled every 90 days.
- Key policies are explicitly defined to grant only required service access (e.g., `ec2.amazonaws.com`, `rds.amazonaws.com`, `secretsmanager.amazonaws.com`).

### üîë AWS Secrets Manager
- The RDS database password is randomly generated by Terraform and stored in AWS Secrets Manager.
- Secrets are encrypted using the custom KMS key.
- EC2 instances retrieve the password securely at boot using the attached IAM role.

### üóÉÔ∏è RDS Instance
- PostgreSQL 17 is deployed with encryption enabled.
- Uses a dedicated DB subnet group with private subnets.
- IAM authentication and secure password bootstrapping is configured via Secrets Manager.

### üì¶ Auto Scaling Group & Launch Template
- EC2 instances are launched using a versioned Launch Template.
- The Launch Template includes configuration for:
    - IAM instance profile
    - Custom AMI (built via Packer)
    - Encrypted EBS volume using KMS
    - User-data script to configure the web app
- Auto Scaling Group is configured with:
    - Minimum: 3 instances
    - Maximum: 5 instances
    - Launch template version is updated dynamically in CI/CD.

### üåê Load Balancer & HTTPS (SSL)
- Application Load Balancer (ALB) is configured with:
    - HTTPS listener on port 443
    - ACM certificates:
        - **Dev**: Automatically requested and validated via Route53 using Terraform
        - **Demo**: Uses a pre-imported certificate from Namecheap, attached via ARN
    - Target group forwards HTTP traffic to EC2 instances on port 8080.

## Environments

The project uses Terraform to provision and manage infrastructure components across two AWS environments: **dev** and **demo**.



## AWS Networking Infrastructure with Terraform and GitHub Actions CI

This project provisions AWS networking infrastructure using Terraform and enforces CI/CD best practices through GitHub Actions.

## Table of Contents

- [Overview](#overview)

## Overview

Creates a highly available AWS network infrastructure with:
-  1 VPC
-  3 Public Subnets (across 3 AZs)
-  3 Private Subnets (across 3 AZs)
-  Internet Gateway
-  Route Tables with proper associations
-  Security Group for Web Application
-  EC2 Instance in Public Subnet
-  S3 bucket with Custom Policy and Role for EC2 to access S3
-  RDS with Security group and custom parameter

Enforces CI checks via GitHub Actions:
- Terraform formatting validation
- Terraform configuration validation
- Branch protection rules